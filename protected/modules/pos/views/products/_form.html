<form method="post" id="product-form" class="mt20" action="{% if model.item_id %}{{ 'pos/products/update' | link }}/{{ model.item_id }}?outlet={{ outlet.id }}{% else %}{{ 'pos/products/create' | link }}{% endif %}">
    <div class="alert alert-success" style="display: none;"></div>
    <div class="col-md-12 mb10">
        <p>Kolom bertanda <span class="red">*</span> tidak boleh dikosongi</p>
    </div>
    <div class="col-md-6">
        {% if outlets %}
        <div class="form-group">
            <label for="reg_select">Outlet <span class="text-danger">*</span></label>
            <select id="reg_select" name="Products[outlet_id]" class="form-control">
                {% for i, outlet in outlets %}
                <option value="{{ outlet.id }}">{{ outlet.title }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        <div class="form-group">
            <label for="name">Nama Produk <span class="text-danger">*</span></label>
            <input type="text" id="name" name="Products[name]" class="form-control" {% if model.name %}value="{{ model.name }}"{% endif %} required>
        </div>
        <div class="form-group">
            <label for="cost_price">Cost Price <span class="text-danger">*</span></label>
            <input type="text" id="cost_price" name="Products[cost_price]" class="form-control mask" {% if model.cost_price %}value="{{ model.cost_price | number_format(2, ',', '.') }}"{% endif %}>
        </div>
        <div class="form-group">
            <label for="unit-price">Unit Price <span class="text-danger">*</span></label>
            <input type="text" id="unit-price" name="Products[unit_price]" class="form-control mask" {% if model.unit_price %}value="{{ model.unit_price | number_format(2, ',', '.') }}"{% endif %}>
        </div>
    </div>
    <div class="col-md-6">
        <div class="form-group">
            <label for="barcode">Barcode <span class="text-danger">*</span></label>
            <input type="text" id="barcode" name="Products[item_number]" class="form-control" {% if model.item_number %}value="{{ model.item_number }}"{% endif %} required>
        </div>
        {% if not model.item_id %}
        <div class="form-group">
            <label for="stock">Jumlah Stok <span class="text-danger">*</span></label>
            <input type="text" id="stock" name="Products[quantity]" class="form-control" value="1" required>
        </div>
        {% endif %}
        <div class="form-group">
            <label for="desc">Deskripsi</label>
            <textarea name="Products[description]" id="desc" cols="10" rows="2" class="form-control">{% if model and model.description %}{{ model.description }}{% endif %}</textarea>
        </div>
        {% if model.item_id %}
        <div class="form-group">
            <div class="checkbox">
                <label>
                    <input name="Products[update_others]" value="1" type="checkbox">
                    Update juga item ini untuk <b>Outlet</b> yang lainnya.
                </label>
            </div>
        </div>
        {% endif %}
        <input type="hidden" name="Products[item_id]" value="{{ model.item_id }}">
        <div class="form-group">
            <input type="submit" value="Simpan" class="btn btn-info">
        </div>
    </div>
</form>

<script src="{{ 'js/jquery.maskMoney.min.js' | admin_asset_url }}"></script>
<script type="text/javascript">
    $(function () {
        $('#product-form').submit(function (e) {
            e.preventDefault();
            var url = $(this).attr('action');
            $.ajax({
                'url': url,
                'type':'post',
                'data': $('#product-form').serialize(),
                'success': function(data) {
                    if (data.status == 'success') {
                        var alert_success = $('#product-form').find('.alert-success');
                        alert_success.html(data.message);
                        alert_success.show();
                        $('#product-form')[0].reset();
                        setTimeout(function () {
                            alert_success.hide();
                            alert_success.empty();
                            window.location.reload(true);
                        }, 2000);
                    }
                }
            });

            return false;
        });
        $(".mask").maskMoney({prefix:'', allowNegative: false, thousands:'.', decimal:',', affixesStay: false});
    });
</script>