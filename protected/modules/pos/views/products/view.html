{% extends "layout.html" %}
{% block pagetitle %}
Produk - {{ App.params.site_name }}
{% endblock %}

{% block content %}
<link href="{{ 'lib/bootstrap-table/dist/bootstrap-table.min.css' | admin_asset_url }}" rel="stylesheet" media="screen">
<!-- main content -->
<div id="main_wrapper">
    <div class="page_bar clearfix">
        <div class="row">
            <div class="col-sm-10">
                <h1 class="page_title">Produk</h1>
                <p class="text-muted">Kelola data produk</p>
            </div>
            <div class="col-sm-2 text-right">
                <a class="btn btn-default" href="{{ 'pos/products/create' | link }}">Buat Produk Baru</a>
            </div>
        </div>
    </div>
    <div class="page_content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <ul class="nav nav-tabs main-tabs" id="tabs_a">
                                {% set idx = 1 %}
                                {% for i, outlet in outlets %}
                                <li {% if i == 1 %}class="active"{% endif %}>
                                    <a data-toggle="tab" href="#outlet-{{ idx }}" outlet-id="{{ outlet.id }}">{{ outlet.title }}</a>
                                </li>
                                {% set idx = idx + 1 %}
                                {% endfor %}
                            </ul>
                            <div class="tab-content" id="tabs_content_a">
                                {% set idx2 = 1 %}
                                {% for j, outlet in outlets %}
                                <div id="outlet-{{ idx2 }}" class="tab-pane fade {% if j == 1 %}in active{% endif %}">
                                    <table
                                            data-show-export="true"
                                            data-pagination="true"
                                            data-show-pagination-switch="true"
                                            data-search="true"
                                            data-toggle="table"
                                            data-url="{{ 'pos/products/price-info' | link }}/{{ outlet.id }}">
                                        <thead>
                                        <tr>
                                            <th data-sortable="true" data-field="item_id" data-align="center">Item ID</th>
                                            <th data-field="name">Item Name</th>
                                            <th data-field="item_number" data-align="center">Barcode</th>
                                            <th data-field="cost_price" data-formatter="moneyFormatter" data-align="right">Cost Price</th>
                                            <th data-field="unit_price" data-formatter="moneyFormatter" data-align="right">Unit Price</th>
                                            <th data-formatter="TableActions" data-align="center">Action</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                                {% set idx2 = idx2 + 1 %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% include 'partial/right_menu.html' %}

<script src="{{ 'lib/bootstrap-table/src/bootstrap-table.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/bootstrap-table/dist/extensions/export/bootstrap-table-export.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/bootstrap-table/dist/extensions/mobile/bootstrap-table-mobile.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/bootstrap-table/dist/extensions/sticky-header/bootstrap-table-sticky-header.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/bootstrap-table/dist/locale/bootstrap-table-id-ID.min.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/file-saver.js/FileSaver.js' | admin_asset_url }}" type="text/javascript"></script>
<script src="{{ 'lib/tableExport.jquery.plugin/tableExport.min.js' | admin_asset_url }}"></script>

{% endblock %}
{% block endbodyjs %}
<script type="text/javascript">
    function hapus(data) {
        if (confirm('Anda yakin ingin menghapus item ini ?')) {
            var $this =  $(data);
            var url = $this.attr('href');
            $.ajax({
                'url': url,
                'type':'post',
                //'dataType': 'json',
                'success': function(data) {
                    if (data.status == 'success') {
                        $this.parent().parent().remove();
                    }
                }
            });
        }
        return false;
    }
    $(function () {
       if (window.location.hash) {
           var hash = window.location.hash.substring(1);
           if ($('a[href="#'+hash+'"]').length > 0)
                $('a[href="#'+hash+'"]').click();
       }
    });
    function moneyFormatter(data) {
        var decimalCount = 2, decimal = ",", thousands = ".";
        var total = 0;

        if (data.length > 0) {

            try {
                decimalCount = Math.abs(decimalCount);
                decimalCount = isNaN(decimalCount) ? 2 : decimalCount;

                const negativeSign = data < 0 ? "-" : "";

                var i = parseInt(data = Math.abs(Number(data) || 0).toFixed(decimalCount)).toString();
                var j = (i.length > 3) ? i.length % 3 : 0;

                return negativeSign + (j ? i.substr(0, j) + thousands : '') + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousands) + (decimalCount ? decimal + Math.abs(data - i).toFixed(decimalCount).slice(2) : "");
            } catch (e) {
                console.log(e)
            }
        }

        return '';
    };

    function TableActions (value, row, index) {
        var outlet_id = row.outlet_id;
        var item_id = row.item_id;
        var update_url = "{{ 'pos/products/update' | link }}/"+ item_id +"?outlet="+ outlet_id;
        var delete_url = "{{ 'pos/products/delete' | link }}/"+ item_id +"?outlet="+ outlet_id;
        $action = [
            '<a href="'+ update_url +'" title="Ubah Outlet"><i class="fa fa-pencil"></i></a> ',
            '<a href="'+ delete_url +'" class="return hapus(this);"><i class="fa fa-trash-o"></i></a>'
        ].join('');

        return $action;
    }
</script>
{% endblock %}
